let productItems = [
  {
    id: 1,
    image: "../media/cart.media/pic1.png",
    name: "pink poeny pot",
    type: "poeny",
    price: 17.99,
  },
  {
    id: 2,
    image: "../media/cart.media/pic2.png",
    name: "pink rose",
    type: "rose",
    price: 15.99,
  },
  {
    id: 3,
    image: "../media/cart.media/pic3.png",
    name: "white tulip",
    type: "tulip",
    price: 22.99,
  },
  {
    id: 4,
    image: "../media/cart.media/pic4.png",
    name: "poeny",
    type: "poeny",
    price: 15.99,
  },
  {
    id: 5,
    image: "../media/cart.media/pic5.png",
    name: "white tulip",
    type: "tulip",
    price: 16.99,
  },
  {
    id: 6,
    image: "../media/cart.media/pic6.png",
    name: "poeny bouquet",
    type: "poeny",
    price: 25.99,
  },
  {
    id: 7,
    image: "../media/cart.media/pic7.png",
    name: "poeny",
    type: "poeny",
    price: 19.99,
  },
  {
    id: 8,
    image: "../media/cart.media/pic8.png",
    name: "small bouquet",
    type: "other",
    price: 13.99,
  },
  {
    id: 9,
    image: "../media/cart.media/pic9.png",
    name: "flower pot",
    type: "other",
    price: 24.99,
  },
  {
    id: 10,
    image: "../media/cart.media/pic10.png",
    name: "Malus Cardinal",
    type: "other",
    price: 20.99,
  },
  {
    id: 11,
    image: "../media/cart.media/pic11.png",
    name: "corn flower",
    type: "other",
    price: 12.99,
  },
  {
    id: 12,
    image: "../media/cart.media/pic12.png",
    name: "lavender pot",
    type: "lavender",
    price: 22.99,
  },
  {
    id: 13,
    image: "../media/cart.media/pic13.png",
    name: "Marigold",
    type: "marigold",
    price: 15.99,
  },
  {
    id: 14,
    image: "../media/cart.media/pic14.png",
    name: "tulip",
    type: "tulip",
    price: 23.99,
  },
  {
    id: 15,
    image: "../media/cart.media/pic15.png",
    name: "red rose",
    type: "rose",
    price: 19.99,
  },
  {
    id: 16,
    image: "../media/cart.media/pic16.png",
    name: "colorful daisy",
    type: "daisy",
    price: 18.99,
  },
  {
    id: 17,
    image: "../media/cart.media/pic17.png",
    name: "Camellia",
    type: "other",
    price: 21.99,
  },
  {
    id: 18,
    image: "../media/cart.media/pic18.png",
    name: "Day-lity",
    type: "other",
    price: 20.99,
  },
  {
    id: 19,
    image: "../media/cart.media/pic19.png",
    name: "Pink poeny",
    type: "poeny",
    price: 23.99,
  },
  {
    id: 20,
    image: "../media/cart.media/pic20.png",
    name: "Sunflower",
    type: "sunflower",
    price: 22.99,
  },
  {
    id: 21,
    image: "../media/cart.media/pic21.png",
    name: "Pansy",
    type: "other",
    price: 24.99,
  },
  {
    id: 22,
    image: "../media/cart.media/pic22.png",
    name: "Honeysuckle",
    type: "other",
    price: 20.99,
  },
  {
    id: 23,
    image: "../media/cart.media/pic23.png",
    name: "Peony bouquet",
    type: "poeny",
    price: 25.99,
  },
  {
    id: 24,
    image: "../media/cart.media/pic24.png",
    name: "Poeny bouquet",
    type: "poeny",
    price: 25.99,
  },
  {
    id: 25,
    image: "../media/cart.media/pic25.png",
    name: "Rose round bouquet",
    type: "rose",
    price: 29.99,
  },
  {
    id: 26,
    image: "../media/cart.media/pic26.png",
    name: "Chrysanthemum",
    type: "other",
    price: 22.99,
  },
  {
    id: 27,
    image: "../media/cart.media/pic27.png",
    name: "Sandy rose bouquet",
    type: "rose",
    price: 23.99,
  },
  {
    id: 28,
    image: "../media/cart.media/pic28.png",
    name: "Rosy poeny",
    type: "poeny",
    price: 22.99,
  },
  {
    id: 29,
    image: "../media/cart.media/pic29.png",
    name: "Green rose bouquet",
    type: "rose",
    price: 27.99,
  },
  {
    id: 30,
    image: "../media/cart.media/pic30.png",
    name: "Rose",
    type: "rose",
    price: 18.99,
  },
  {
    id: 31,
    image: "../media/cart.media/pic31.png",
    name: "Delphis flower",
    type: "other",
    price: 16.99,
  },

  {
    id: 32,
    image: "../media/cart.media/pic32.png",
    name: "Big rose bouquet",
    type: "rose",
    price: 28.99,
  },
  {
    id: 33,
    image: "../media/cart.media/pic33.png",
    name: "Handy rose bouquet",
    type: "rose",
    price: 18.99,
  },
  {
    id: 34,
    image: "../media/cart.media/pic34.png",
    name: "Pink tulip",
    type: "tulip",
    price: 25.99,
  },
  {
    id: 35,
    image: "../media/cart.media/pic35.png",
    name: "Rose",
    type: "rose",
    price: 19.99,
  },
  {
    id: 36,
    image: "../media/cart.media/pic36.png",
    name: "Gerbera bouquet",
    type: "other",
    price: 19.99,
  },
  {
    id: 37,
    image: "../media/cart.media/pic37.png",
    name: "Rose pot",
    type: "rose",
    price: 24.99,
  },
  {
    id: 38,
    image: "../media/cart.media/pic38.png",
    name: "Rose",
    type: "rose",
    price: 21.99,
  },
  {
    id: 39,
    image: "../media/cart.media/pic39.png",
    name: "Water lily bouquet",
    type: "lily",
    price: 20.99,
  },
  {
    id: 40,
    image: "../media/cart.media/pic40.png",
    name: "Dahlia bouquet",
    type: "dahlia",
    price: 23.99,
  },
  {
    id: 41,
    image: "../media/cart.media/pic41.png",
    name: "Big Rose Bouquet",
    type: "rose",
    price: 29.99,
  },
  {
    id: 42,
    image: "../media/cart.media/pic42.png",
    name: "Heliconia Firebird",
    type: "other",
    price: 22.99,
  },
];

localStorage.setItem("products", JSON.stringify(productItems));

let day = new Date().getTime();
let products = JSON.parse(localStorage.getItem("products"));

function productCode() {
  for (let i = 0; i < products.length; i++) {
    products[i].code = Math.floor(Math.random() * 100000) + day;
  }
  localStorage.setItem("products", JSON.stringify(products));
}
// productCode();

function quantityObj() {
  let dataCart = JSON.parse(localStorage.getItem("products"));
  for (let i = 0; i < dataCart.length; i++) {
    dataCart[i].quantity = 1;
  }
  localStorage.setItem("products", JSON.stringify(dataCart));
}
quantityObj();

//----------------------render all products-------------------------

let a = 0;
let i = 0;
let thisPage = 1;
let limit = 6;
function renderProduct(i) {
  a = i * limit;
  let result = "";
  for (let i = a; i < a + limit; i++) {
    !products[i]
      ? ""
      : (result += test(
          i,
          products[i].image,
          products[i].id,
          products[i].name,
          products[i].price
        ));
  }
  listPage();
  document.getElementsByClassName("product")[0].innerHTML = result;
}
renderProduct(i);

let header = document.getElementById("myUl");
let btns = header.getElementsByClassName("btn-floral");
for (let i = 0; i < btns.length; i++) {
  btns[i].addEventListener("click", function () {
    let current = document.getElementsByClassName("active");
    current[0].className = current[0].className.replace(" active", "");
    this.className += " active";
  });
}
// -----------------------all types------------------------
function allType() {
  renderProduct(0);
  document.getElementsByClassName("listPage")[0].style.display = "flex";
}

function test(i, image, id, name, price) {
  return `<div class="box" id="${i}">
  <div class="image">
    <img src="${image}">
      <div class="icons">
          <button class="fas fa-heart"></button>
          <button class="cart-btn" onclick="addToCart(${id})">add to cart</button>
          <button class="fas fa-share"></button>
      </div>
    </div>
  <div class="content">
  <h3>${name}</h3>
  <div class="price"> $${price}</div>
  </div>
</div>`;
}

function typeDivide(Type) {
  let newType = "";
  let products = JSON.parse(localStorage.getItem("products"));
  let product = products.filter((e) => e.type == Type);
  for (i = 0; i < product.length; i++) {
    newType += test(
      i,
      product[i].image,
      product[i].id,
      product[i].name,
      product[i].price
    );
  }
  document.getElementsByClassName("product")[0].innerHTML = newType;
  document.getElementsByClassName("listPage")[0].style.display = "none";
}

//-----------------------rose-------------------------------------
function typeRose(rose) {
  typeDivide(rose);
}

//-----------------------lily-------------------------------------
function typeLily(lily) {
  typeDivide(lily);
}

//-----------------------poeny-------------------------------------
function typePoeny(poeny) {
  typeDivide(poeny);
}

//-----------------------tulip-------------------------------------
function typeTulip(tulip) {
  typeDivide(tulip);
}

//-----------------------lavender-------------------------------------
function typeLavender(lavender) {
  typeDivide(lavender);
}

//-----------------------marigold-------------------------------------
function typeMarigold(marigold) {
  typeDivide(marigold);
}

//-----------------------daisy-------------------------------------
function typeDaisy(daisy) {
  typeDivide(daisy);
}

//-----------------------sunflower-------------------------------------
function typeSunflower(sunflower) {
  typeDivide(sunflower);
}

//-----------------------dahlia-------------------------------------
function typeDahlia(dahlia) {
  typeDivide(dahlia);
}
//-----------------------other-------------------------------------
function typeOther(other) {
  typeDivide(other);
}

// ----------------------page seperation---------------------------
function listPage() {
  let count = Math.ceil(products.length / limit);
  document.querySelector(".listPage").innerHTML = "";
  if (thisPage != 1) {
    let prev = document.createElement("li");
    prev.innerText = "PREV";
    prev.setAttribute("onclick", "changePage(" + (thisPage - 1) + ")");
    document.querySelector(".listPage").appendChild(prev);
  }
  for (i = 1; i <= count; i++) {
    let newPage = document.createElement("li");
    newPage.innerText = i;
    if (i == thisPage) {
      newPage.classList.add("active");
    }
    newPage.setAttribute("onclick", "changePage(" + i + ")");
    document.querySelector(".listPage").appendChild(newPage);
  }
  if (thisPage != count) {
    let next = document.createElement("li");
    next.innerText = "NEXT";
    next.setAttribute("onclick", "changePage(" + (thisPage + 1) + ")");
    document.querySelector(".listPage").appendChild(next);
  }
}

function changePage(i) {
  thisPage = i;
  loadItem(i);
}

function loadItem(i) {
  renderProduct(i - 1);
  listPage();
}

// ---------------------------add to cart------------------------
function addToCart(id) {
  let cart = JSON.parse(localStorage.getItem("cart"));
  let flagSignIn = localStorage.getItem("flagSignIn");

  if (!flagSignIn) {
    const snackbar = document.createElement("div");
    snackbar.classList.add("snackbar");
    snackbar.innerText = "Please login before shopping!";
    document.body.appendChild(snackbar);

    setTimeout(() => {
      snackbar.remove();
    }, 2000);
    return;
  }

  let userCart = cart[flagSignIn];
  for (let i = 0; i < userCart.length; i++) {
    if (userCart[i].id == id) {
      const snackbar = document.createElement("div");
      snackbar.classList.add("snackbar");
      snackbar.innerText = "This product is already in your cart.";
      document.body.appendChild(snackbar);

      setTimeout(() => {
        snackbar.remove();
      }, 2000);
      return;
    }
  }

  for (let i = 0; i < products.length; i++) {
    if (products[i].id == id) {
      userCart.push(products[i]);
      const snackbar = document.createElement("div");
      snackbar.classList.add("snackbar");
      snackbar.innerText = "Product is added to cart successfully!";
      document.body.appendChild(snackbar);

      setTimeout(() => {
        snackbar.remove();
      }, 2000);
      break;
    }
  }

  cart = { ...cart, [flagSignIn]: userCart };
  localStorage.setItem("cart", JSON.stringify(cart));

  let cartUpdate = JSON.parse(localStorage.getItem("cart"));
  let statusLogin = localStorage.getItem("flagSignIn");
  let userCartUpdate = cartUpdate[statusLogin];
  document.getElementById("quantity").innerHTML = userCartUpdate.length;
}
